SUBDIR		= doc src
DISTDIR		= dist
DISTNAME	= DarwinPorts-${DISTVER}
DISTARCNAME	= DarwinPorts-${DISTVER}-archive

include Mk/dports.subdir.mk
include Mk/dports.autoconf.mk

Mk/dports.autoconf.mk src/pextlib1.0/config.h: configure
	@if test -f ./config.status ; then	\
		set -x ;						\
		./config.status --recheck ;		\
		touch Mk/dports.autoconf.mk ;	\
		touch src/pextlib1.0/config.h ;	\
	else								\
		set -x ;						\
		echo "Source tree not configured. Use ./configure" ; \
	fi

all:: Mk/dports.autoconf.mk

install::
	$(INSTALL) -o ${DSTUSR} -g ${DSTGRP} -m 644 dp_version ${DESTDIR}${portconfigdir}
	@echo ""
	@echo "Congratulations, you have successfully installed the DarwinPorts system."
	@echo ""
	@echo "To get the Portfiles and update the system run:"
	@echo ""
	@echo "sudo port selfupdate"
	@echo ""
	@echo "Please read README_RELEASE1 and port(1)."
	@echo ""

clean::

distclean::
	rm -f config.log config.status configure.lineno
	rm -rf autom4te.cache ${DISTDIR}
	rm -f Makefile Mk/dports.autoconf.mk
	
dist:: distclean
	@[ -n "${DISTVER}" ] || ( echo Must specify DISTVER, like: make DISTVER=1.1 dist; exit 1 )
	[ -d ${DISTDIR} ] || mkdir ${DISTDIR}
	# http://forums.macosxhints.com/printthread.php?t=43243 for COPY_EXTENDED_ATTRIBUTES_DISABLE info
	COPY_EXTENDED_ATTRIBUTES_DISABLE=true tar --exclude CVS --exclude ${DISTDIR} -c . | gzip > ${DISTDIR}/${DISTNAME}.tar.gz
	COPY_EXTENDED_ATTRIBUTES_DISABLE=true tar --exclude CVS --exclude ${DISTDIR} -c . | bzip2 > ${DISTDIR}/${DISTNAME}.tar.bz2
	COPY_EXTENDED_ATTRIBUTES_DISABLE=true tar --exclude CVS --exclude ${DISTDIR} -c .. | gzip > ${DISTDIR}/${DISTARCNAME}.tar.gz
	COPY_EXTENDED_ATTRIBUTES_DISABLE=true tar --exclude CVS --exclude ${DISTDIR} -c .. | bzip2 > ${DISTDIR}/${DISTARCNAME}.tar.bz2
	
	cd ${DISTDIR}; for type in -md5 -sha1 -ripemd160; do openssl dgst $$type *.gz *.bz2; done > ${DISTNAME}.chk.txt
	cat ${DISTDIR}/${DISTNAME}.chk.txt

test::
